

<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Redis &mdash; Code-Cookbook 0.1 文档</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="SQL JOINS" href="SQL%20JOINS.html" />
    <link rel="prev" title="MySQL语句执行顺序" href="MySQL%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Code-Cookbook
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="0904%E6%A8%A1%E6%8B%9F%E9%9D%A2%E8%AF%95%E9%A2%98%E6%95%B4%E7%90%86.html">模拟面试题整理</a></li>
<li class="toctree-l1"><a class="reference internal" href="1008%E6%A8%A1%E6%8B%9F%E9%9D%A2%E8%AF%95%E6%95%B4%E7%90%86.html">实时存储NoSQL模拟面试</a></li>
<li class="toctree-l1"><a class="reference internal" href="Annotation.html">元注解</a></li>
<li class="toctree-l1"><a class="reference internal" href="Annotation.html#id2">注解解析</a></li>
<li class="toctree-l1"><a class="reference internal" href="Bigdata%E9%98%B2%E6%87%B5%E9%80%BC%E6%8C%87%E5%8D%97.html">Bigdata Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="Collection.html">集合</a></li>
<li class="toctree-l1"><a class="reference internal" href="Collection.html#id9">简单(常用)数据结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="Flink%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE%E4%B8%8E%E5%9F%BA%E7%A1%80%E5%8E%9F%E7%90%86.html">Flink基础配置与基础原理</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hbase.html">Hbase</a></li>
<li class="toctree-l1"><a class="reference internal" href="Hive%20SQL50%E9%A2%98%E8%AE%B0%E5%BD%95.html">Hive SQL50题记录</a></li>
<li class="toctree-l1"><a class="reference internal" href="IO%E6%B5%81.html"><code class="docutils literal notranslate"><span class="pre">IO</span> <span class="pre">Stream</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="JDBC.html">JDBC</a></li>
<li class="toctree-l1"><a class="reference internal" href="Java%20Cookbook.html">JAVA Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="Java_Maven.html">Maven</a></li>
<li class="toctree-l1"><a class="reference internal" href="Java_OOP.html">面向对象是基于面向过程的编程思想</a></li>
<li class="toctree-l1"><a class="reference internal" href="Java_OOP.html#id2">特征</a></li>
<li class="toctree-l1"><a class="reference internal" href="Java_OOP.html#java-java">Java中最基础的单位是类，类是Java中最基础的单位</a></li>
<li class="toctree-l1"><a class="reference internal" href="Java%E4%B8%ADSocket%E5%8F%91%E9%80%81%E6%96%87%E4%BB%B6%E8%87%B3%E6%9C%8D%E5%8A%A1%E7%AB%AF.html">使用Java在服务端和客户端之间传送文件</a></li>
<li class="toctree-l1"><a class="reference internal" href="Kafka.html">Kafka</a></li>
<li class="toctree-l1"><a class="reference internal" href="MySQL%2050%E9%A2%98%E8%AE%B0%E5%BD%95.html">MySQL 50题记录</a></li>
<li class="toctree-l1"><a class="reference internal" href="MySQL%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F.html">MySQL语句执行顺序</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Redis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">应用场景</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">特点</a></li>
<li class="toctree-l2"><a class="reference internal" href="#windowsredis">Windows上使用Redis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id4">数据类型和语法</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#string">String</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hash">Hash</a></li>
<li class="toctree-l3"><a class="reference internal" href="#list">List</a></li>
<li class="toctree-l3"><a class="reference internal" href="#set">Set</a></li>
<li class="toctree-l3"><a class="reference internal" href="#zset">Zset</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">通用命令</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id6">持久化</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#rdb">RDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="#aof">AOF</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#id7">集群搭建</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id8">模式</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">主从复制</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sentinel">哨兵模式Sentinel</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id10">集群模式</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="SQL%20JOINS.html">SQL JOINS</a></li>
<li class="toctree-l1"><a class="reference internal" href="SimpleDataStruct.html">简单(常用)数据结构</a></li>
<li class="toctree-l1"><a class="reference internal" href="Socket.html">Socket</a></li>
<li class="toctree-l1"><a class="reference internal" href="Sqoop%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8.html">Sqoop</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E5%8F%AF%E8%83%BD%E6%9C%89%E7%94%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E9%93%BE%E6%8E%A5.html">可能有用的学习链接</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E5%8F%AF%E8%83%BD%E6%9C%89%E7%94%A8%E7%9A%84%E5%AD%A6%E4%B9%A0%E9%93%BE%E6%8E%A5.html#hive-orc">Hive - ORC 文件存储格式</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E5%A4%9A%E7%BA%BF%E7%A8%8B.html">多线程</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%B9%B3%E5%8F%B0%E7%8E%AF%E5%A2%83%E4%B8%8E%E6%95%B0%E4%BB%93.html">大数据平台环境与数仓</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6%E6%A2%B3%E7%90%86.html">常用软件梳理</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E6%8B%89%E9%93%BE%E8%A1%A8.html">SCD</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E6%8B%89%E9%93%BE%E8%A1%A8.html#id2">拉链表</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E4%B8%8EHive.html">数据仓库</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E4%B8%8EHive.html#hive">Hive</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C.html">数据倾斜</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%9E%8B%E9%97%AE%E9%A2%98.html">生产者消费者模型问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E6%A2%B3%E7%90%86.html">JavaSE_Day08</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E6%A2%B3%E7%90%86.html#id9">面向对象</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E6%A2%B3%E7%90%86.html#api">常用API</a></li>
<li class="toctree-l1"><a class="reference internal" href="%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%90%84%E7%A7%8D%E5%85%B3%E7%B3%BB.html">Java OOP防脱发指南</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Code-Cookbook</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Redis</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/blogs/Redis.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="redis">
<h1>Redis<a class="headerlink" href="#redis" title="永久链接至标题">¶</a></h1>
<div class="section" id="id1">
<h2>介绍<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p>本质：分布式的<strong>基于内存</strong>的NoSQL<strong>数据库</strong></p>
<ul>
<li><p>数据库：用于存储数据的</p></li>
<li><p>分布式：解决了高并发和存储能力的问题</p></li>
<li><p>特点：</p>
<ul>
<li><p>基于内存</p></li>
<li><p>所有的数据都会存储在内存中，所有的读写都直接操作内存</p>
<ul>
<li><p>问题</p>
<ul>
<li><p>内存：小、易丢失</p></li>
</ul>
</li>
<li><p>解决</p>
<ul>
<li><p>小：集群分布式构成<strong>分布式内存</strong></p></li>
<li><p>易丢失：虽然数据都在内存中，但磁盘中保留一份数据，每次重新启动都会从磁盘中将数据加载到内存</p></li>
</ul>
</li>
<li><p>问题：写入磁盘又需要提供高性能的读写，如何实现？</p>
<ul>
<li><p>数据安全和性能必须二选一</p></li>
<li><p>保证数据安全的情况的前提下提供最好的性能</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>功能：基于数据库设计，实现数据存储</p></li>
<li><p>实现：基于内存的数据存储</p></li>
<li><p>数据库分类：</p>
<ul>
<li><p>RDBMS：关系型数据库管理系统</p>
<ul>
<li><p>MySQL、Oracle、SQLServer</p></li>
<li><p>特点：</p>
<ul>
<li><p>一般都支持SQL语句</p></li>
<li><p>允许数据之间的关联</p></li>
<li><p>存储容量较小，存储数据量如果较大性能就会下降</p></li>
</ul>
</li>
<li><p>区别：性能的区别</p></li>
</ul>
</li>
<li><p>NoSQL(Not Only SQL)：非关系型数据库</p>
<ul>
<li><p>Redis、Hbase、MongoDB</p></li>
<li><p>特点：</p>
<ul>
<li><p>每种NoSQL的特点都不一样</p></li>
<li><p>为了追求小数据量高性能读写如Redis</p></li>
<li><p>为了解决大数据量的高性能读写如HBase</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id2">
<h2>应用场景<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p>传统的web开发</p>
<ul>
<li><p>用于实现读缓存</p>
<ul>
<li><p>传统网站架构</p>
<ul>
<li><p>同时大量的并发读写请求MySQL，而MySQL无法响应支持这种高并发的场景，导致请求失败</p></li>
</ul>
</li>
</ul>
</li>
<li><p>引入Redis</p>
<ul>
<li><p>实现读写分离，写入MySQL，将大量的高并发的<strong>读</strong>请求提交给Redis来实现</p></li>
</ul>
</li>
</ul>
</li>
<li><p>大数据的应用场景</p>
<ul>
<li><p>适合于高并发的场景</p></li>
<li><p>适合于读写性能要求非常高的场景</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id3">
<h2>特点<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p>分布式</p></li>
<li><p>基于内存</p></li>
<li><p>基于C语言开发，对内存的管理、编译、数据的存储更加的高效</p></li>
<li><p>支持高并发：并发量：单台机器10w/s</p></li>
<li><p>不能代替MySQL</p>
<ul>
<li><p>MySQL：支持复杂的业务，以及复杂数据存储，支持SQL，更加稳定</p></li>
<li><p>Redis：高并发高性能，存在数据丢失的隐患，存储结构比较单一，不能满足业务存储</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="windowsredis">
<h2>Windows上使用Redis<a class="headerlink" href="#windowsredis" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p>架构</p>
<ul>
<li><p>Standalone：单节点</p></li>
</ul>
</li>
<li><p>使用</p>
<ul>
<li><p>启动服务端</p>
<ul>
<li><p>Redis-server.exe</p></li>
</ul>
</li>
<li><p>启动客户端</p>
<ul>
<li><p>Redis-cli.exe</p></li>
</ul>
</li>
</ul>
</li>
<li><p>数据结构</p>
<ul>
<li><p>KV结构：</p>
<ul>
<li><p>整个Redis中所有的数据都是以KV进行读写的</p></li>
<li><p>通过K来读写Value</p></li>
</ul>
</li>
<li><p>数据类型</p>
<ul>
<li><p>K：Redis中每条数据即每个KV的K都是String类型的(<strong>永远都是String类型</strong>)</p></li>
<li><p>V：Redis的V有五种类型结构</p>
<ul>
<li><p>String：字符串类型</p></li>
<li><p>Hash：类似于Java中的Map集合</p>
<ul>
<li><p>Java：</p></li>
<li><p>Map1（K：string， map2：HashMap）</p></li>
</ul>
</li>
<li><p>List：集合类型，有序可重复集合</p></li>
<li><p>Set：集合类型，无序不可重复</p></li>
<li><p>Zset：集合类型，有序不可重复集合</p>
<ul>
<li><p>类似于Java中的TreeMap</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id4">
<h2>数据类型和语法<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<div class="section" id="string">
<h3>String<a class="headerlink" href="#string" title="永久链接至标题">¶</a></h3>
</div>
<div class="section" id="hash">
<h3>Hash<a class="headerlink" href="#hash" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>语法</p>
<ul>
<li><p>单个属性写入：hset</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hset</span>	<span class="n">K</span>	<span class="n">V</span><span class="p">[]</span>
</pre></div>
</div>
</li>
<li><p>单个属性读取：hget</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hget</span>	<span class="n">K</span>	<span class="n">v1</span>
</pre></div>
</div>
</li>
<li><p>批量添加：hmset</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>hmset 	K 	V[k1  v1  K2  v2 ……]
</pre></div>
</div>
</li>
<li><p>批量化读取：hmget</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hmget</span> <span class="n">K</span> <span class="n">K1</span> <span class="n">K2</span> <span class="n">K3</span>
</pre></div>
</div>
</li>
<li><p>获取所有的属性：hgetall</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hgetall</span> <span class="n">K</span>
</pre></div>
</div>
</li>
<li><p>删除Hash中的某个元素：hdel</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hdel</span>  <span class="n">K</span>  <span class="n">K1</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="list">
<h3>List<a class="headerlink" href="#list" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>应用：有序可重复的集合的数据</p>
<ul class="simple">
<li><p>类似于Java中的List</p></li>
<li><p>用于存放一系列有序变化的数据</p></li>
</ul>
</li>
<li><p>使用</p>
<ul>
<li><p>插入</p>
<ul>
<li><p>左序插入：lpush</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>lpush K V<span class="o">[</span>e1 e2 e3 e4<span class="o">]</span>
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#实际存放的是</span>
K  e4 e3 e2 e1
</pre></div>
</div>
</li>
<li><p>右序插入：rpush</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rpush</span> <span class="n">K</span> <span class="n">V</span><span class="p">[</span><span class="n">e1</span> <span class="n">e2</span> <span class="n">e3</span> <span class="n">e4</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#实际存放的是</span>
K  e1 e2 e3 e4
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>读取：lrange</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lrange</span> <span class="n">K</span> <span class="n">start</span> <span class="n">end</span>
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#左序查询：起始位置为0</span>
lrange list1  <span class="m">0</span>  <span class="m">1</span>
<span class="c1">#右序查询</span>
</pre></div>
</div>
</li>
<li><p>长度：llen</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>llen K
</pre></div>
</div>
</li>
<li><p>删除元素</p>
<ul>
<li><p>左边删除：lpop</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>lpop K
</pre></div>
</div>
</li>
<li><p>右边删除：rpop</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="set">
<h3>Set<a class="headerlink" href="#set" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>应用：无序不可重复的集合，用于去重统计等等</p>
<ul class="simple">
<li><p>类似于Java中的set集合</p></li>
</ul>
</li>
<li><p>使用：</p>
<ul>
<li><p>插入数据：sadd</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sadd</span>  <span class="n">K</span>  <span class="n">V</span><span class="p">[</span><span class="n">e1</span> <span class="n">e2</span> <span class="n">e3</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>查询数据：smembers</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">smembers</span> <span class="n">K</span>
</pre></div>
</div>
</li>
<li><p>元素判断：sismember</p>
<ul>
<li><p>判断当前set元素是否是该set的成员</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sismembers</span>  <span class="n">K</span>  <span class="n">e</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>元素的移除：srem</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">srem</span>  <span class="n">K</span>  <span class="n">e</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="zset">
<h3>Zset<a class="headerlink" href="#zset" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>应用：有序不可重复的集合，一般用于排序取TopN</p></li>
<li><p>使用</p>
<ul>
<li><p>添加元素：zadd</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zadd</span>  	<span class="n">K</span>   <span class="p">[</span><span class="n">score1</span> <span class="n">V1</span> <span class="n">score2</span> <span class="n">V2</span> <span class="n">score3</span> <span class="n">V3</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>查询：zrange</p>
<ul class="simple">
<li><p>默认升序</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zrange</span>  <span class="n">K</span>   <span class="n">start</span>  <span class="n">end</span>    <span class="p">[</span><span class="n">withscores</span><span class="p">]</span>
</pre></div>
</div>
<blockquote>
<div><p>在使用Redis时，不建议存储double类型的score，因为其在底层会有精度为题</p>
<p>如果需要存储double类型，将其转换为int类型</p>
<p>写:20.01 x 100 = 2001</p>
<p>读:2001 / 100 = 20.01</p>
</div></blockquote>
</li>
<li><p>倒叙查询：zrevrange</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zrevrange</span>  <span class="n">K</span>  <span class="n">start</span>  <span class="n">end</span> <span class="p">[</span><span class="n">withscores</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>取集合长度：zcard</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zcard</span> <span class="n">K</span>
</pre></div>
</div>
</li>
<li><p>移除元素：zrem</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">zrem</span>   <span class="n">K</span>   <span class="n">Vkey</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id5">
<h3>通用命令<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h3>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">key</span> <span class="pre">*</span></code> ：列举当前数据库中的所有KV</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">del</span></code>：用于删除当前数据库中的某个KV</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">del</span> <span class="pre">name</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">exists</span></code>：用于判断当前数据库中是否存在某个key</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">exists</span> <span class="pre">K</span></code></p></li>
</ul>
</li>
<li><p>type：用于查看某个K的类型</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">type</span> <span class="pre">K</span></code></p></li>
</ul>
</li>
<li><p>select ：切换数据库</p></li>
<li><p>move：用于实现数据库之间key的移动</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#切换进1数据库</span>
<span class="k">select</span> <span class="m">1</span>
<span class="c1">#将数据库1中的s2移动至0数据库下</span>
move s2 <span class="m">0</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="id6">
<h2>持久化<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p>Redis如何实现将内存中的数据写入磁盘</p>
<ul>
<li><p>RDB：默认的持久化方式</p></li>
<li><p>AOF：工作中使用</p></li>
</ul>
</li>
</ul>
<div class="section" id="rdb">
<h3>RDB<a class="headerlink" href="#rdb" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>功能：在规定时间内，内存中产生了一定次数的更新(增删改)，就会将内存中的数据做一次全量快照</p></li>
<li><p>实现：</p>
<ul>
<li><p>自动实现：配置文件决定</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">save</span>  <span class="n">时间</span>  <span class="n">数据更新的次数</span>
<span class="n">save</span>  <span class="mi">300</span>   	<span class="mi">10</span>
</pre></div>
</div>
</li>
<li><p>如果300秒内，产生了十次数据更新，就将内存中的数据全量覆盖到本地磁盘</p></li>
<li><p>配置文件中的默认规则</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">save</span>  <span class="mi">900</span>   <span class="mi">1</span>
<span class="n">save</span>  <span class="mi">300</span>   <span class="mi">10</span> 
<span class="n">save</span>  <span class="mi">60</span>    <span class="mi">10000</span>
</pre></div>
</div>
<ul>
<li><p>可以配置多组策略，热河一组达到条件，都会触发快照的生成</p></li>
<li><p>多组策略的设计目的：保证各种读写场景下的数据安全</p>
<ul class="simple">
<li><p>读多、写少：不需要频繁地构建快照，内存与文件的数据基本一致</p></li>
<li><p>写多、读少：数据更新地比较频繁，短时间内有大量数据生成，需要频繁更新</p></li>
</ul>
</li>
<li><p>快照存放的位置</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/export/server/{$Redis}/redisdata/
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>手动生成</p>
<ul class="simple">
<li><p>save：手动阻塞Redis的所有请求，将内存的数据做一次全量快照写入磁盘</p>
<ul>
<li><p>指导快照生成完成，恢复所有的读写请求</p></li>
</ul>
</li>
<li><p>bgsave：后台启动一个线程来实现快照生成，不影响读写不影响业务</p></li>
</ul>
</li>
</ul>
</li>
<li><p>优缺点</p>
<ul class="simple">
<li><p>优点：</p>
<ul>
<li><p>每次做的是全量快照，内存中的数据肯定和磁盘中的数据一样</p></li>
<li><p>这种快照是二进制文件，生成和读写都很快</p></li>
</ul>
</li>
<li><p>缺点：</p>
<ul>
<li><p>容易产生数据丢失</p></li>
<li><p>达到了时间，但是更新次数没达到，如果机器故障，已经更新的数据就丢失了</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="aof">
<h3>AOF<a class="headerlink" href="#aof" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>设计：</p>
<ul class="simple">
<li><p>规定时间内或者指定操作做增量的同步</p>
<ul>
<li><p>每次只将内存中发生变化的数据<strong>追加写入</strong>磁盘</p></li>
</ul>
</li>
</ul>
</li>
<li><p>规则：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>appendfsync no:不进行fsync，将flush文件的实际交给OS决定，速度最快
appendfsync always:每写入一条日志就进行一次fsync操作，数据安全性最高，但是速度最慢
appendfsync everysec:折中的做法，交由后台线程每秒fsync一次，每秒将内存更新的数据同步追加到磁盘中，最多会产生1s的数据丢失
</pre></div>
</div>
</li>
<li><p>一般选用第三种方式，即appendfsync everysec</p></li>
<li><p>优缺点</p>
<ul>
<li><p>优点：数据丢失的概率或者比例变小，数据相对安全，而且保证了性能</p></li>
<li><p>缺点：</p>
<ul>
<li><p>以追加的方式，将内存中更新的数据写入普通文本文件</p>
<ul class="simple">
<li><p>相对于二进制文件，写入和读取加载都比较慢</p></li>
</ul>
</li>
<li><p>内存数据与磁盘数据不一致</p>
<ul>
<li><p>解决：定期做全量</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#如果当前的数据相对于上一次的初始文件增长了百分之百，就做一次全量</span>
<span class="n">auto</span><span class="o">-</span><span class="n">aof</span><span class="o">-</span><span class="n">rewrite</span><span class="o">-</span><span class="n">percentage</span> <span class="mi">100</span>
<span class="n">auto</span><span class="o">-</span><span class="n">aof</span><span class="o">-</span><span class="n">rewrite</span><span class="o">-</span><span class="nb">min</span><span class="o">-</span><span class="n">size</span> <span class="mi">64</span><span class="n">MB</span>
</pre></div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="id7">
<h2>集群搭建<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h2>
<div class="section" id="id8">
<h3>模式<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h3>
<ul class="simple">
<li><p>单节点</p>
<ul>
<li><p>一台机器Redis</p>
<ul>
<li><p>如果这台Redis故障，会导致整个业务不可用</p></li>
<li><p>一台机器的内存有限，无法实现大数据的实时存储</p></li>
</ul>
</li>
</ul>
</li>
<li><p>集群模式</p>
<ul>
<li><p>主从复制</p></li>
<li><p>哨兵模式</p></li>
<li><p>集群模式/分区模式</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id9">
<h3>主从复制<a class="headerlink" href="#id9" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>架构</p>
<ul class="simple">
<li><p>类似于Zookeeper</p></li>
<li><p>主从节点</p>
<ul>
<li><p>Master：主节点</p>
<ul>
<li><p>负责提供读写</p></li>
</ul>
</li>
<li><p>Slave：从节点</p>
<ul>
<li><p>负责提供读，不能接受写的请求</p></li>
<li><p>会写Master同步数据</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>特点</p>
<ul class="simple">
<li><p>每台节点上存储的内容是一致的</p></li>
<li><p>只有Master能够接受写的请求</p></li>
<li><p>如果Master故障，Slave不能变成Master</p></li>
</ul>
</li>
<li><p>问题</p>
<ul class="simple">
<li><p>Master存在单点故障，导致集群不可写入</p></li>
</ul>
</li>
<li><p>配置</p>
<ul>
<li><p>修改node2和node3的配置文件</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#修改265行，指定master地址</span>
<span class="n">slaveof</span> <span class="n">node1</span> <span class="mi">6379</span>
</pre></div>
</div>
</li>
<li><p>启动所有机器的redis-server</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">export</span><span class="o">/</span><span class="n">servers</span><span class="o">/</span><span class="n">redis</span><span class="o">-</span><span class="mf">3.2</span><span class="o">.</span><span class="mi">8</span>
<span class="n">src</span><span class="o">/</span><span class="n">redis</span><span class="o">-</span><span class="n">server</span> <span class="n">redis</span><span class="o">.</span><span class="n">conf</span>
<span class="n">ps</span> <span class="o">-</span><span class="n">ef</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">redis</span>
</pre></div>
</div>
</li>
<li><p>连接第一台机器客户端</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">src</span><span class="o">/</span><span class="n">redis</span><span class="o">-</span><span class="n">cli</span> <span class="o">-</span><span class="n">h</span> <span class="n">node1</span>
</pre></div>
</div>
</li>
<li><p>写入一条数据</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">set</span> <span class="n">s1</span> <span class="n">bigdata</span>
</pre></div>
</div>
</li>
<li><p>观察其他节点的数据，在从节点尝试写入数据</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="sentinel">
<h3>哨兵模式Sentinel<a class="headerlink" href="#sentinel" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>架构</p>
<ul class="simple">
<li><p>主从架构</p>
<ul>
<li><p>主：Master</p></li>
<li><p>从：Slave</p></li>
<li><p>哨兵进程：</p>
<ul>
<li><p>负责监听Master以及其他节点，如果发现Master宕机，就会从Slave中重新选举一个新的Master</p></li>
<li><p>监听所有的节点，并且哨兵之间互相通信</p></li>
</ul>
</li>
</ul>
</li>
<li><p>特点：</p>
<ul>
<li><p>每台节点存储的数据是一样的</p></li>
</ul>
</li>
<li><p>区别：与主从复制的区别</p>
<ul>
<li><p>Slave可以选举成为Master</p></li>
</ul>
</li>
<li><p>设计</p>
<ul>
<li><p>Step1：哨兵进程会监听Master。如果有一个哨兵发现Master故障，会通知其他的哨兵</p>
<ul>
<li><p>主观性Master故障</p></li>
</ul>
</li>
<li><p>Step2：一旦达到配置的哨兵个数认为Master故障，确认Master中的故障</p>
<ul>
<li><p>客观性Master故障</p></li>
</ul>
</li>
<li><p>Step3：从Slave中根据选举规则选举出新的Master</p></li>
</ul>
</li>
</ul>
</li>
<li><p>问题</p>
<ul class="simple">
<li><p>解决了Master单点故障，但是依旧存在Redis集群存储容量负载的问题</p></li>
<li><p>哨兵本身的机制也存在一些缺点</p>
<ul>
<li><p>不支持动态扩容</p></li>
</ul>
</li>
</ul>
</li>
<li><p>配置</p>
<ul>
<li><p>关闭三台机器的redisserver</p></li>
<li><p>修改三台机器的sentinel.conf</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /export/servers/redis-3.2.8
vim sentinel.conf
<span class="c1">#在第15行下面添加以下两行，指定地址和后台运行，每台机器要改成自己的主机名</span>
<span class="nb">bind</span> node1
daemonize yes
<span class="c1">#修改第71，监控master地址。mymaster是master的逻辑名称，node1是当前master的地址，2表示有2个哨兵认为故障就要切换</span>
sentinel monitor mymaster node1 <span class="m">6379</span> <span class="m">2</span>
</pre></div>
</div>
</li>
<li><p>启动三台机器的redis server和哨兵进程</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /export/servers/redis-3.2.8
src/redis-server redis.conf
src/redis-sentinel sentinel.conf 
ps -ef <span class="p">|</span> grep redis
</pre></div>
</div>
</li>
<li><p>测试关闭第一台进程</p></li>
<li><p>代码中如何实现连接访问</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</li>
</ul>
<p>//方案三：构建哨兵连接池：第一个参数是master的逻辑名称，第二个参数是哨兵列表，第三个是连接池的配置
HashSet<String> sets = new HashSet&lt;&gt;();
sets.add(“node1:26379”);
sets.add(“node2:26379”);
sets.add(“node3:26379”);
JedisSentinelPool mymaster = new JedisSentinelPool(“mymaster”, sets, jedisPoolConfig);
//从连接池中获取连接
jedis = mymaster.getResource();</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>

</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="id10">
<h3>集群模式<a class="headerlink" href="#id10" title="永久链接至标题">¶</a></h3>
<ul>
<li><p>架构</p>
<ul class="simple">
<li><p>设计：将一个Redis的普通集群当做Redis集群模式的一个部分，利用多个Redis集群来存储不同的数据</p></li>
<li><p>去中心化思想</p></li>
</ul>
</li>
<li><p>配置</p>
<ul>
<li><p>演示：一台机器启动三个Redis：作为三个Master，只要端口不一致即可</p></li>
<li><p>第一台机器解压重新安装</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">export</span><span class="o">/</span><span class="n">software</span><span class="o">/</span>
<span class="n">tar</span> <span class="o">-</span><span class="n">zxf</span> <span class="n">redis</span><span class="o">-</span><span class="mf">3.2</span><span class="o">.</span><span class="mf">8.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span> <span class="o">-</span><span class="n">C</span> <span class="o">/</span><span class="n">export</span><span class="o">/</span>
</pre></div>
</div>
</li>
<li><p>编译</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">export</span><span class="o">/</span><span class="n">redis</span><span class="o">-</span><span class="mf">3.2</span><span class="o">.</span><span class="mi">8</span><span class="o">/</span>
<span class="n">make</span> <span class="o">&amp;&amp;</span> <span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</li>
<li><p>创建目录</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir -p /export/redis-3.2.8/cluster 
<span class="nb">cd</span>  /export/redis-3.2.8/cluster
mkdir <span class="m">7001</span> <span class="m">7002</span> <span class="m">7003</span> 
cp /export/redis-3.2.8/redis.conf  <span class="m">7001</span>/
</pre></div>
</div>
</li>
<li><p>修改7001目录下的配置文件</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</li>
</ul>
<p>cd /export/redis-3.2.8/cluster/7001
vim redis.conf
#61行：绑定redis server地址
bind node1
#84行：修改redis实例的端口
port 7001
#128行：开启守护进程
daemonize yes
#593行：开启aof
appendonly yes
#721行：开启集群模式
cluster-enabled yes
#729行：指定redis默认配置文件
cluster-config-file nodes.conf
#735行：指定超时时间
cluster-node-timeout 5000</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
- 将配置文件复制给7002和7003，并修改端口为7002和7003

```shell
cd /export/redis-3.2.8/cluster/7001
cp redis.conf ../7002/
cp redis.conf ../7003/
vim ../7002/redis.conf
#84行：修改redis实例的端口
port 7002
vim ../7003/redis.conf
#84行：修改redis实例的端口
port 7003
</pre></div>
</div>
<ul>
<li><p>启动三个redis实例</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</li>
</ul>
<p>cd /export/redis-3.2.8/cluster/7001
redis-server redis.conf
cd /export/redis-3.2.8/cluster/7002
redis-server redis.conf
cd /export/redis-3.2.8/cluster/7003
redis-server redis.conf</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>


- 安装ruby环境

- 安装依赖

  ```
yum install openssl-devel  zlib-devel  -y
  ```

- 将ruby安装包上传到/export目录中

  ```
cd /export/
  tar -zxvf ruby-2.5.3.tar.gz
  cd ruby-2.5.3
  ./configure --prefix=/usr/local/ruby
  make &amp;&amp; make install
  echo &quot;export PATH=$PATH:/usr/local/ruby/bin&quot; &gt;&gt; /etc/profile
  source /etc/profile
  gem install redis
  ```


</pre></div>
</div>
</li>
<li><p>创建redis集群</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /export/redis-3.2.8/src/
./redis-trib.rb create --replicas <span class="m">0</span> <span class="m">192</span>.168.88.221:7001 <span class="m">192</span>.168.88.221:7002 <span class="m">192</span>.168.88.221:7003
</pre></div>
</div>
</li>
<li><p>启动客户端测试</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> /export/redis-3.2.8/
src/redis-cli -c -h node1 -p <span class="m">7001</span>

-c：表示是一个集群模式
</pre></div>
</div>
</li>
<li><p>Jedis代码中的连接</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">JedisCluster</span> <span class="n">jedisCluster</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="c1">//构建集群模式的额连接池</span>
<span class="n">HashSet</span><span class="o">&lt;</span><span class="n">HostAndPort</span><span class="o">&gt;</span> <span class="n">sets</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">HostAndPort</span><span class="o">&gt;</span><span class="p">();</span>
<span class="n">sets</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="n">HostAndPort</span><span class="p">(</span><span class="s">&quot;node1&quot;</span><span class="p">,</span><span class="mi">7001</span><span class="p">));</span>
<span class="n">sets</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="n">HostAndPort</span><span class="p">(</span><span class="s">&quot;node1&quot;</span><span class="p">,</span><span class="mi">7002</span><span class="p">));</span>
<span class="n">sets</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="n">HostAndPort</span><span class="p">(</span><span class="s">&quot;node1&quot;</span><span class="p">,</span><span class="mi">7003</span><span class="p">));</span>
<span class="n">jedisCluster</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JedisCluster</span><span class="p">(</span><span class="n">sets</span><span class="p">,</span> <span class="n">jedisPoolConfig</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>分区的规则</p>
<ul class="simple">
<li><p>通过槽位计算，将不同的KV存储在不同的Redis的Master中</p></li>
</ul>
</li>
<li><p>CRC16【K】 &amp;  16383  =  0 ~ 16383</p>
<ul class="simple">
<li><p>对K进行计算</p></li>
<li><p>根据不同的槽位值，写入不同的Redis的Master中</p></li>
</ul>
</li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="SQL%20JOINS.html" class="btn btn-neutral float-right" title="SQL JOINS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="MySQL%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F.html" class="btn btn-neutral float-left" title="MySQL语句执行顺序" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; 版权所有 2020, roohom

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>